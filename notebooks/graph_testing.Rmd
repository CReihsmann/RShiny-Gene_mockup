---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Execute entire block - *Cmd+Shift+Enter*. \

Add a new chunk by pressing *Cmd+Option+I*.

Packages
```{r}
library(tidyverse)
library(ggplot2)
library(plotly)
library(ggpubr)
library(Seurat)
```
Reads in dataset
```{r}
human <- read_csv('../data/20230602-human_data.csv')
nhp <- read_csv('../data/20230602-nhp_data.csv')
mouse <- read_csv('../data/20230602-mouse_data.csv')
orthologs <- read_csv('../data/20230607-orthologs-hm_nhp_ms.csv')
```
Human bar plot
```{r}
colors <- c('gray', 'purple', 'violet', 'orange3', 'pink3', 'olivedrab4', 'plum4', 'blue', 'green', 'red')

level_order <- c('Fibroblasts', 'Acinar', 'Ductal', 'Stellate', 'Immune', 'Endothelial', 'Gamma', 'Epsilon', 'Delta', 'Beta', 'Alpha')

human$celltype <- factor(human$celltype, levels = level_order)

human %>% 
  filter(Gene == 'INS') %>% 
  ggplot(aes(x=celltype, y = avg_expr, fill = celltype)) + 
  geom_col(position = position_dodge()) +
  coord_flip() +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        legend.position = 'none') +
  labs(y = 'Scaled Expression') +
  fill_palette(palette = colors) +
  scale_x_discrete(drop = F)
  
```

creating ortholog dictionaries
```{r}
human_genes <- human %>% 
  select(Gene) %>% 
  distinct() %>% 
  left_join(orthologs, by = c('Gene' = 'Gene name'))
nhp_orthos <- with(human_genes, setNames(`Macaque gene name`, `Gene`))
ms_orthos <- with(human_genes, setNames(`Mouse gene name`, `Gene`))
```
Non-human Primate bar plot
```{r}
nhp$celltype <- factor(nhp$celltype, levels = level_order)

nhp %>% 
  filter(Gene == nhp_orthos['INS']) %>% 
  ggplot(aes(x=celltype, y = avg_expr, fill = celltype)) + 
  geom_col() +
  coord_flip() +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        legend.position = 'none') +
  labs(y = 'Scaled Expression') +
  fill_palette(palette = colors) +
  scale_x_discrete(drop = F)
```
Mouse bar plot
```{r}
mouse$celltype <- factor(mouse$celltype, levels = level_order)

mouse %>% 
  filter(Gene == ms_orthos['INS']) %>% 
  ggplot(aes(x=celltype, y = avg_expr, fill = celltype)) + 
  geom_col() +
  coord_flip() +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        legend.position = 'none') +
  labs(y = 'Scaled Expression') +
  fill_palette(palette = colors) +
  scale_x_discrete(drop = F)
```

```{r}

```

